# Results

```{r, echo=FALSE}
library(rvest)
library(dplyr)
library(janitor)
library(ggplot2)
library(stringr)
library(plotly)
library(purrr)
library(tidyverse)
library(scales)
```


```{r, echo=FALSE}
url_2014 <- "https://www.basketball-reference.com/leagues/NBA_2015.html"
season_2014 <- read_html(url_2014) |> html_element("table#per_game-team") |> html_table(fill = TRUE) |> clean_names() |> mutate(season = "2014-15")

url_2015 <- "https://www.basketball-reference.com/leagues/NBA_2016.html"
season_2015 <- read_html(url_2015) |> html_element("table#per_game-team") |> html_table(fill = TRUE) |> clean_names() |> mutate(season = "2015-16")

url_2016 <- "https://www.basketball-reference.com/leagues/NBA_2017.html"
season_2016 <- read_html(url_2016) |> html_element("table#per_game-team") |> html_table(fill = TRUE) |> clean_names() |> mutate(season = "2016-17")

url_2017 <- "https://www.basketball-reference.com/leagues/NBA_2018.html"
season_2017 <- read_html(url_2017) |> html_element("table#per_game-team") |> html_table(fill = TRUE) |> clean_names() |> mutate(season = "2017-18")

url_2018 <- "https://www.basketball-reference.com/leagues/NBA_2019.html"
season_2018 <- read_html(url_2018) |> html_element("table#per_game-team") |> html_table(fill = TRUE) |> clean_names() |> mutate(season = "2018-19")

win_loss_2014 <- read_csv("/Users/pranavkandula/Desktop/School/Fall 2025/EDAV/Final_P/NBA-Playstyle-Analysis/data/advanced/advanced_stats_nba (2).csv") |> rename(W = W)
win_loss_2015 <- read_csv("/Users/pranavkandula/Desktop/School/Fall 2025/EDAV/Final_P/NBA-Playstyle-Analysis/data/advanced/advanced_stats_nba_2015.csv") |> rename(W = W)
win_loss_2016 <- read_csv("/Users/pranavkandula/Desktop/School/Fall 2025/EDAV/Final_P/NBA-Playstyle-Analysis/data/advanced/advanced_stats_nba_2016.csv") |> rename(W = W)
win_loss_2017 <- read_csv("/Users/pranavkandula/Desktop/School/Fall 2025/EDAV/Final_P/NBA-Playstyle-Analysis/data/advanced/advanced_stats_nba_2017.csv") |> rename(W = W) |> rename(team = Team)
win_loss_2018 <- read_csv("/Users/pranavkandula/Desktop/School/Fall 2025/EDAV/Final_P/NBA-Playstyle-Analysis/data/advanced/advanced_stats_nba_2018.csv") |> rename(W = W)
base_path <- "/Users/pranavkandula/Desktop/School/Fall 2025/EDAV/Final_P/NBA-Playstyle-Analysis/data/threep/"
years <- 2007:2019
yearly_stats <- data.frame()

for (year in years) {
  file_name <- paste0(base_path, year, ".csv")
  data <- read.csv(file_name, stringsAsFactors = FALSE, check.names = FALSE)
  
  if ("3P▼" %in% colnames(data)) {
    colnames(data)[colnames(data) == "3P▼"] <- "ThreeP_Made"
  } else if ("3p_" %in% colnames(data)) {  
    colnames(data)[colnames(data) == "3p_"] <- "ThreeP_Made"
  } else if ("3P" %in% colnames(data)) {
    colnames(data)[colnames(data) == "3P"] <- "ThreeP_Made"
  } else {
    colnames(data)[12] <- "ThreeP_Made"
  }
  
  if ("3PA" %in% colnames(data)) {
    colnames(data)[colnames(data) == "3PA"] <- "ThreeP_Att"
  } else {
    colnames(data)[13] <- "ThreeP_Att"
  }

  if ("3P%" %in% colnames(data)) {
    colnames(data)[colnames(data) == "3P%"] <- "ThreeP_Pct"
  } else {
    colnames(data)[14] <- "ThreeP_Pct"
  }
  
  data$ThreeP_Made <- as.numeric(as.character(data$ThreeP_Made))
  data$ThreeP_Pct <- as.numeric(as.character(data$ThreeP_Pct))
  data$ThreeP_Att <- as.numeric(as.character(data$ThreeP_Att))
  
  avg_stats <- data |>
    arrange(desc(ThreeP_Made)) |>
    head(5) |>
    summarise(
      Year = year,
      Avg_Efficiency = mean(ThreeP_Pct, na.rm = TRUE),
      Avg_Attempts = mean(ThreeP_Att, na.rm = TRUE)
    )
  
  yearly_stats <- rbind(yearly_stats, avg_stats)
}

yearly_stats_long <- yearly_stats |>
  pivot_longer(cols = c("Avg_Efficiency", "Avg_Attempts"), 
               names_to = "Metric", 
               values_to = "Value") |>
  mutate(
    Metric = case_when(
      Metric == "Avg_Efficiency" ~ "3-Point Efficiency (%)",
      Metric == "Avg_Attempts" ~ "3-Point Attempts"
    )
  )

```


```{r, echo=FALSE}
url <- "https://www.basketball-reference.com/leagues/NBA_stats_per_game.html"
league_avgs <- url |>
  read_html() |>
  html_element("table") |>
  html_table(fill = TRUE) |>
  row_to_names(row_number = 1) |>
  clean_names() |>
  mutate(season = as.character(season))

league_avgs <- league_avgs |>
  mutate(start_year = as.numeric(str_sub(season, 1, 4))) |>
  filter(start_year >= 1979) |>
  select(-start_year) |>
  mutate(start_year = as.numeric(str_sub(season, 1, 4)),
         x3pa_num = as.numeric(x3pa))

# Load league stats for pace and offensive rating
url <- "https://www.basketball-reference.com/leagues/NBA_stats_per_game.html"
league_stats <- read_html(url) |>
  html_element("table") |>
  html_table(fill = TRUE) |>
  row_to_names(row_number = 1) |>
  clean_names() |>
  filter(season != "Season") |>
  mutate(
    season_start = as.numeric(str_sub(season, 1, 4)),
    ortg = as.numeric(o_rtg), 
    pace = as.numeric(pace)
  ) |>
  filter(season_start >= 1980)
```


## The Three-Point Shot

We begin our analysis by examining the evolution of the three-point shot. Since the NBA started tracking threes in 1979, the league has undergone a dramatic transformation in both volume and efficiency. By exploring how three-point attempts and accuracy have changed over time, we can better understand the shifting strategies and playstyles that define the modern game.
```{r}
ggplot(data = league_avgs, aes(x = start_year, y = x3pa_num)) +
  geom_line(color = "steelblue", size = 1.2) +
  geom_point(color = "steelblue", size = 3, alpha = 0.7) +
  labs(
    title = "3-Point Attempts Over Time",
    subtitle = "Average 3-point attempts per game by season (1979-2025)",
    x = "Season",
    y = "3-Point Attempts per Game",
    caption = "Source: Basketball Reference"
  ) +
  scale_y_continuous(breaks = seq(0, 40, 5)) +
  scale_x_continuous(breaks = seq(1979, 2025, 5)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    plot.caption = element_text(size = 9, color = "gray50"),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "gray90")
  )

```

```{r}
league_avgs <- league_avgs |>
  mutate(x3p_num = as.numeric(x3p),
         x3p_pct = (x3p_num / x3pa_num) * 100)

ggplot(data = league_avgs, aes(x = start_year, y = x3p_pct)) +
  geom_line(color = "coral", size = 1.2) +
  geom_point(color = "coral", size = 3, alpha = 0.7) +
  labs(
    title = "3-Point Shooting Efficiency",
    subtitle = "Average 3-point percentage by season (1979-2025)",
    x = "Season",
    y = "3-Point Percentage (%)",
    caption = "Source: Basketball Reference"
  ) +
  scale_y_continuous(breaks = seq(25, 40, 2.5)) +
  scale_x_continuous(breaks = seq(1979, 2025, 5)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    plot.caption = element_text(size = 9, color = "gray50"),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "gray90")
  )

```

From this graph, we can clearly see a steady rise in three-point attempts over time. A closer look reveals a distinct period in which the three-point shot surged in both usage and importance, signaling a major shift in how the game was played. Let's identify this pivotal era and explore the factors that sparked its transformation.

```{r}
league_avgs <- league_avgs |>
  arrange(start_year)

five_year_changes <- league_avgs |>
  mutate(x3pa_5yr_ago = lag(x3pa_num, 5),
         five_year_change = x3pa_num - x3pa_5yr_ago,
         five_year_pct_change = (five_year_change / x3pa_5yr_ago) * 100,
         period = paste(start_year - 5, "-", start_year)) |>
  filter(!is.na(five_year_change)) |>
  select(start_year, period, x3pa_num, x3pa_5yr_ago, five_year_change, five_year_pct_change)

biggest_increase <- five_year_changes |>
  arrange(desc(five_year_change)) |>
  slice(1) |>
  select(-start_year)

print(biggest_increase)
```

From this table, the most significant surge occurs between 2014 and 2019. This period stands out as a transformative era for the three-point shot. To understand what drove this rapid rise, we’ll take a closer look at the top three-point shooters from these years and explore to understand what happened.

```{r}
ggplot(yearly_stats_long, aes(x = factor(Year), y = Value, fill = Metric)) +
  geom_col(width = 0.7, alpha = 0.85) +
  facet_wrap(~Metric, scales = "free_y", ncol = 1, strip.position = "top") +
  scale_fill_manual(values = c("3-Point Attempts" = "steelblue", 
                                "3-Point Efficiency (%)" = "coral")) +
  labs(
    title = "Evolution of 3-Point Shooting Among Elite Shooters",
    subtitle = "Average statistics of top 5 three-point leaders per season (2007-2019)",
    x = "Season",
    y = NULL,
    caption = "Source: Basketball Reference"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    plot.caption = element_text(size = 9, color = "gray50"),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    axis.title = element_text(size = 12, face = "bold"),
    strip.text = element_text(size = 12, face = "bold"),
    strip.background = element_rect(fill = "gray95", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    legend.position = "none"
  )

```

From this graph, we see that three-point attempts among elite shooters steadily increased over time, which aligns with the trend observed earlier. What is particularly striking is that their efficiency remained consistently high despite the rising volume. This suggests that top shooters became even more skilled by expanding their shot volume without sacrificing accuracy. This development is crucial in elevating the value of the three-point shot, as players were now able to score efficiently at much higher frequencies. Next, we will look at the winningest teams from this era to evaluate their playstyle and determine whether they embraced the three-point shot.

```{r}
season_2014 <- season_2014 |> left_join(win_loss_2014, by = "team")
season_2015 <- season_2015 |> left_join(win_loss_2015, by = "team")
season_2016 <- season_2016 |> left_join(win_loss_2016, by = "team")
season_2017 <- season_2017 |> left_join(win_loss_2017, by = "team")
season_2018 <- season_2018 |> left_join(win_loss_2018, by = "team")

top10_list <- list(
  "2014-15" = season_2014,
  "2015-16" = season_2015,
  "2016-17" = season_2016,
  "2017-18" = season_2017,
  "2018-19" = season_2018
)

top10_list <- lapply(top10_list, function(df) {
  df |>
    mutate(
      W = as.numeric(W),
      x3pa = as.numeric(x3pa),
      x3p_percent = as.numeric(x3p_percent)
    ) |>
    arrange(desc(W)) |>
    slice(1:10)
})

season_names <- names(top10_list)
fig <- plot_ly()

for (i in seq_along(top10_list)) {
  season_data <- top10_list[[i]]
  fig <- add_trace(
    fig,
    data = season_data,
    x = ~W,
    y = ~team,
    type = "bar",
    orientation = "h",
    marker = list(
      color = ~x3p_percent,
      colorscale = list(c(0, "lightblue"), c(1, "darkblue")),
      colorbar = list(title = "3P%")
    ),
    text = ~paste0(
      "Team: ", team, "<br>Wins: ", W, 
      "<br>3PA: ", x3pa, "<br>3P%: ", round(x3p_percent * 100, 1), "%"
    ),
    hoverinfo = "text",
    visible = ifelse(i == 1, TRUE, FALSE)
  )
}

buttons <- lapply(seq_along(season_names), function(i) {
  visible <- rep(FALSE, length(season_names))
  visible[i] <- TRUE
  team_order <- rev(top10_list[[i]]$team)
  list(
    method = "update",
    args = list(
      list(visible = visible),
      list(yaxis = list(
        title = "",
        categoryorder = "array",
        categoryarray = team_order
      ))
    ),
    label = season_names[i]
  )
})

fig <- fig |>
  layout(
    title = "Top 10 Teams: Wins and 3-Point Shooting (2014-2019)",
    xaxis = list(title = "Wins"),
    yaxis = list(
      title = "",
      categoryorder = "array",
      categoryarray = rev(top10_list[[1]]$team)
    ),
    updatemenus = list(
      list(
        active = 0,
        buttons = buttons,
        x = -0.5,
        xanchor = "left",
        y = 1.2,
        yanchor = "top"
      )
    ),
    showlegend = FALSE
  )

fig

```

Over the years, we can see a clear pattern: the teams that won the most games are also the ones taking the most three-point shots. But why did this trend emerge? As players became more skilled, elite shooters were able to increase their three-point volume while maintaining high efficiency. This shift forced teams to recognize the true value of the three-pointer from a strategic standpoint.

A player hitting 40% from three generates 1.2 points per shot, while a player shooting 50% on two-pointers produces only 1.0 point per shot. As long range accuracy continued to improve, the advantage of the three-point shot became undeniable. Teams realized that by incorporating more threes into their offensive strategy, they could maximize scoring potential without sacrificing efficiency. This evolution not only changed individual player behavior but also reshaped overall team strategies, making the three-point shot a central element of the modern game.



## The Ripple Effect: How the Three Reshaped the Court

We have seen that the most successful teams take more three-point shots. To explain the underlying mechanics behind the surge in three-point volume we are going to look at how teams created the opportunities to take so many shots. The answer lies in pace (possessions per game). 
```{r}
ggplot(league_stats, aes(x = season_start, y = pace)) +
  geom_line(color = "#1ABC9C", size = 1.3) +
  geom_point(color = "#1ABC9C", size = 2.5) +
  labs(
    title = "Pace of Play Accelerates the 3-Point Revolution",
    subtitle = "League-wide pace: possessions per 48 minutes (1980–2025)",
    x = "Season",
    y = "Pace (Possessions per 48)",
    caption = "Source: Basketball Reference"
  ) +
  geom_vline(xintercept = 2014, linetype = "dashed", color = "gray50") +
  annotate("text", x = 2015, y = max(league_stats$pace) - 1,
           label = "Start of rapid pace rise", color = "gray30", hjust = 0) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    panel.grid.minor = element_blank()
  )

```

Increasing three-point attempts didn’t just require better shooters. It required a faster, more dynamic style of play. Teams had to generate more possessions to fully capitalize on the scoring advantage of the three-pointer. This shift in tempo and strategy gave rise to what is now known as the “Pace and Space” era, where speed, spacing, and efficient long-range shooting became the cornerstone of winning basketball. 

Now that the game is faster, who is taking the shots? It used to be only guards. Now, to get that volume, big men have to shoot too. 

```{r}
get_positional_stats <- function(year) {
  Sys.sleep(2) 
  url <- paste0("https://www.basketball-reference.com/leagues/NBA_", year, "_per_game.html")
  
  tryCatch({
    page <- read_html(url)
    df <- page |>
      html_element("table#per_game_stats") |>
      html_table() |>
      clean_names() |>
      filter(player != "Player") |>
      mutate(
        season = year,
        x3pa = as.numeric(x3pa),
        pos_clean = str_remove(pos, "-.*") 
      ) |>
      select(season, player, pos_clean, x3pa)
    
    df |>
      group_by(season, pos_clean) |>
      summarize(avg_3pa = mean(x3pa, na.rm = TRUE), .groups = "drop")
      
  }, error = function(e) {
    message(paste("Error for year", year))
    return(NULL)
  })
}

target_years <- c(1990, 1995, 2000, 2005, 2010, 2015:2024)
heatmap_data <- map_dfr(target_years, get_positional_stats)

plot_data <- heatmap_data |>
  filter(pos_clean %in% c("PG", "SG", "SF", "PF", "C"))

plot_data$pos_clean <- factor(plot_data$pos_clean, 
                              levels = c("C", "PF", "SF", "SG", "PG"))

ggplot(plot_data, aes(x = as.factor(season), y = pos_clean, fill = avg_3pa)) +
  geom_tile(color = "white", size = 0.5) +
  scale_fill_gradient2(
    low = "#313695",
    mid = "#FFFFBF",
    high = "#A50026",
    midpoint = 2.5,
    name = "Avg 3PA"
  ) +
  labs(
    title = "Blurring the Lines",
    subtitle = "Average 3-Point Attempts by Position (1990-2024)",
    caption = "Source: Basketball Reference | Note: Positions are simplified (e.g. PF-C -> PF)",
    x = "Season",
    y = ""
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 18, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid = element_blank(),
    legend.position = "right",
    legend.title = element_text(size = 10, face = "bold")
  )

```

```{r}
league_avgs <- league_avgs |>
  mutate(
    ft_pct = as.numeric(ft_percent) * 100  
  )

ggplot(league_avgs,
       aes(x = start_year, y = ft_pct)) +
  geom_line(color = "#9B59B6", size = 1.4) +
  geom_point(color = "#9B59B6", size = 2.5) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", 
              color = "#34495E", size = 0.8) +
  scale_x_continuous(breaks = seq(1980, max(league_avgs$start_year), 5)) +
  scale_y_continuous(breaks = seq(70, 80, 1), limits = c(70, 80)) +
  labs(
    title = "The Skill Dividend",
    subtitle = "League average free throw percentage (1979–2025)",
    x = "Season",
    y = "Free Throw Percentage (%)",
    caption = "Source: Basketball Reference"
  ) +
  annotate("text", x = 1990, y = 74, 
           label = "90s/00s Era\n~73-75%", 
           size = 3.5, color = "#9B59B6", fontface = "italic") +
  annotate("text", x = 2020, y = 78.5, 
           label = "Modern Era\n~78-79%", 
           size = 3.5, color = "#9B59B6", fontface = "italic") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    panel.grid.minor = element_blank()
  )

```

Increasing the pace wasn't enough; teams needed a fundamental upgrade in skill across the roster. As evidenced by the league wide rise in Free Throw percentage, the average modern player is simply a more capable shooter than their predecessors. This "skill dividend" allowed the revolution to spread to the frontcourt. Initially a weapon reserved for guards, the three point shot was adopted by Power Forwards and eventually Centers.

The heatmap above visualizes a core strategic insight of the modern era: Spacing. When five players, including the Center, can shoot, the floor spreads completely. This forces the defense to guard the perimeter. A Center who stays in the paint today is often a liability, not because they can't score, but because they fail to create the space that drives efficient offense. 

```{r}
league_avgs_scoring <- league_avgs |>
  mutate(
    fg_num   = as.numeric(fg),
    fga_num  = as.numeric(fga),
    x3p_made = as.numeric(x3p),
    fta_num  = as.numeric(fta),
    ftm_num  = as.numeric(ft),
    pts_num  = as.numeric(pts)
  )

scoring_mix <- league_avgs_scoring |>
  transmute(
    start_year,
    pts_total = pts_num,
    pts_3p    = 3 * x3p_made,
    pts_ft    = ftm_num,
    pts_2p    = pts_total - pts_3p - pts_ft
  ) |>
  filter(!is.na(pts_total), pts_total > 0) |>
  mutate(
    share_3p = pts_3p / pts_total,
    share_ft = pts_ft / pts_total,
    share_2p = pts_2p / pts_total
  )

scoring_mix_ortg <- scoring_mix |>
  inner_join(
    league_stats |>
      select(season_start, ortg),
    by = c("start_year" = "season_start")
  ) |>
  mutate(
    era = case_when(
      start_year < 2000 ~ "Pre-2000",
      start_year < 2014 ~ "Early 3PT Era",
      TRUE ~ "Modern Pace-and-Space"
    )
  )

scoring_long <- scoring_mix_ortg |>
  select(start_year, era, share_2p, share_3p, share_ft) |>
  pivot_longer(
    cols = c(share_2p, share_3p, share_ft),
    names_to = "source",
    values_to = "share"
  ) |>
  mutate(
    source = recode(source,
                    "share_2p" = "2-Point Field Goals",
                    "share_3p" = "3-Point Field Goals",
                    "share_ft" = "Free Throws")
  )

ggplot(scoring_long,
       aes(x = start_year, y = share, fill = source)) +
  geom_area(alpha = 0.9, color = "white", size = 0.3) +
  scale_fill_manual(values = c(
    "2-Point Field Goals" = "#95A5A6",
    "3-Point Field Goals" = "#3498DB",
    "Free Throws"         = "#E74C3C"
  )) +
  scale_y_continuous(labels = scales::percent_format(scale = 100)) +
  scale_x_continuous(breaks = seq(1980, max(scoring_long$start_year), 5)) +
  labs(
    title = "How NBA Offenses Get Their Points",
    subtitle = "Shares of total points from 2s, 3s, and free throws (1979–2025)",
    x = "Season",
    y = "Share of Total Points",
    fill = "Point Source",
    caption = "Source: Basketball Reference"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    legend.position = "bottom"
  )

```

```{r}
get_2p_efficiency <- function(year) {
  Sys.sleep(2) 
  url <- paste0("https://www.basketball-reference.com/leagues/NBA_", year, "_per_game.html")
  
  tryCatch({
    page <- read_html(url)
    df <- page |>
      html_element("table#per_game_stats") |>
      html_table() |>
      clean_names() |>
      filter(player != "Player") |>
      mutate(
        season = year,
        x2p_pct = as.numeric(x2p_percent),  # 2P%
        pos_clean = str_remove(pos, "-.*") 
      ) |>
      select(season, player, pos_clean, x2p_pct)
    
    # Calculate league average 2P% and Center 2P%
    league_avg <- df |>
      summarize(
        season = first(season),
        group = "League Average",
        avg_2p_pct = mean(x2p_pct, na.rm = TRUE)
      )
    
    center_avg <- df |>
      filter(pos_clean == "C") |>
      summarize(
        season = first(season),
        group = "Centers",
        avg_2p_pct = mean(x2p_pct, na.rm = TRUE)
      )
    
    bind_rows(league_avg, center_avg)
      
  }, error = function(e) {
    message(paste("Error for year", year))
    return(NULL)
  })
}

# Scrape 2P% data
target_years_2p <- c(1990, 1995, 2000, 2005, 2010, 2015:2024)

efficiency_data <- map_dfr(target_years_2p, get_2p_efficiency)

# Plot: Line chart comparing League vs Centers
ggplot(efficiency_data,
       aes(x = season, y = avg_2p_pct, color = group)) +
  geom_line(size = 1.4) +
  geom_point(size = 2.5) +
  scale_color_manual(values = c(
    "League Average" = "#95A5A6",
    "Centers" = "#E74C3C"
  )) +
  scale_x_continuous(breaks = seq(min(efficiency_data$season),
                                  max(efficiency_data$season), 5)) +
  scale_y_continuous(labels = scales::percent_format(scale = 1),
                     limits = c(0.40, 0.70)) +
  labs(
    title = "The Layup Line",
    subtitle = "2-point field goal percentage: League average vs Centers (1990–2024)",
    x = "Season (End Year)",
    y = "2-Point FG%",
    color = "",
    caption = "Source: Basketball Reference"
  ) +
  annotate("text", x = 2000, y = 0.48, 
           label = "Clogged lanes\nTough post-ups", 
           size = 3.5, color = "#E74C3C", fontface = "italic") +
  annotate("text", x = 2020, y = 0.65, 
           label = "Open dunks, lobs\nNo traffic", 
           size = 3.5, color = "#E74C3C", fontface = "italic") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    legend.position = "bottom",
    panel.grid.minor = element_blank()
  )

```

This is the core strategic insight. As three-point shooting became more prevalent, the floor naturally spread, reducing the value of midrange shots while opening up driving lanes which we can see from the stacked area chart. With big men stepping out to the perimeter, the court became much more spacious, creating opportunities for players to attack the rim. This marked one of the most significant strategic shifts in NBA history. Teams recognized that a long two-pointer, historically making around 38 to 40 percent of the time, was mathematically inferior to a three-pointer. Consequently, the midrange jumper gradually disappeared from the modern game. Interestingly, the trend in the chart above shows that midrange feild goals declined. Layups and dunks actually increased highlighting the shift toward high-efficiency scoring opportunities as NBA players can very easily make open shots near the rim. 

With these playstyles making scoring more efficient, let’s examine how they impacted overall scoring trends.
```{r}
scoring_output <- league_avgs |>
  inner_join(
    league_stats |> select(season_start, pace),
    by = c("start_year" = "season_start")
  ) |>
  mutate(
    pts_num = as.numeric(pts),
    fga_num = as.numeric(fga),
    ppg = pts_num
  ) |>
  select(start_year, ppg, fga_num) |>
  filter(!is.na(ppg), !is.na(fga_num))

# Plot: PPG over time
ggplot(scoring_output,
       aes(x = start_year, y = ppg)) +
  geom_line(color = "#E74C3C", size = 1.5) +
  geom_point(color = "#E74C3C", size = 2.5, alpha = 0.8) +
  scale_x_continuous(name = "Year") +
  scale_y_continuous(breaks = seq(100, 120, 2.5)) +
  labs(
    title = "The Efficiency Dividend",
    subtitle = "Points per game increased",
    x = "Year",
    y = "Points Per Game",
    caption = "Source: Basketball Reference"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    legend.position = "bottom",
    panel.grid.minor = element_blank()
  )

```

